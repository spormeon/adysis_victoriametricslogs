services:
  # Victoria Metrics instance, storing metrics
  # victoria-metrics:
  #   image: adysis/victoriametrics:v2.0.8
  #   container_name: victoriametrics
  #   ports:
  #     - 8080:8080  # UI access
  #     - 8428:8428
  #     - 8089:8089
  #     - 8089:8089/udp
  #     - 2003:2003
  #     - 2003:2003/udp
  #     - 4242:4242
  #   volumes:
  #     - victoria-metrics-data:/storage  # Defined volume
  #     - /proc:/host/proc:ro
  #     - ./prometheus.yml:/etc/prometheus/prometheus.yml  # Scraping config
  #     - ./vm_metrics_config.sh:/etc/vm/vm_metrics_config.sh  # Custom config script
  #   environment:
  #     - ENABLE_TCP6=true  # Enable TCP over IPv6
  #   # command:
  #   #   - "sh /etc/vm/vm_metrics_config.sh"  # Executes the custom config script
  #   restart: always
  #   networks:
  #     - adysis-metrics
  #   # network_mode: host  # Use host network mode directly
  #   dns:
  #     - 127.0.0.1  # Docker's internal DNS resolver

  # Victoria Logs instance, storing and querying logs
  victorialogs:
    image: adysis/victoriametrics-logs:v1.0.5
    container_name: victorialogs
    ports:
      # - 8686:8686  # Exposing the logs API on port 8686
      - "9428:9428"  # ui
    volumes:
      - victorialogs-data:/vlogs  # Volume to store logs data
    # environment:
    #   - ENABLE_TCP6=true  # Enable TCP over IPv6
    command:
      - "-storageDataPath=/vlogs"
      # - -loggerFormat=json
      # - -syslog.listenAddr.tcp=0.0.0.0:514
      # - -datadog.streamFields=service,hostname,ddsource
      # - -journald.streamFields=_HOSTNAME,_SYSTEMD_UNIT,_PID
      # - -journald.ignoreFields=MESSAGE_ID,INVOCATION_ID,USER_INVOCATION_ID,
      # - -journald.ignoreFields=_BOOT_ID,_MACHINE_ID,_SYSTEMD_INVOCATION_ID,_STREAM_ID,_UID
    restart: always
    networks:
      - adysis-metrics
    # network_mode: host  # Use host network mode directly
    # dns:
    #   - 127.0.0.1  # Docker's internal DNS resolver

  # Vector service to collect logs and send to VictoriaLogs
  vector:
    image: docker.io/timberio/vector:0.47.X-alpine
    container_name: vector
    volumes:
      - type: bind
        source: /var/run/docker.sock
        target: /var/run/docker.sock
      - type: bind
        source: /var/lib/docker
        target: /var/lib/docker
      # - ./vector.yml:/usr/local/etc/victoriametricslogs/vector.yaml:ro  # Vector configuration file
      - ./vector.yml:/etc/vector/vector.yaml:ro  # Vector configuration file
      # - ./haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg
    # environment:
    #   - VECTOR_LOG="error"  # Enable debug logs for troubleshooting
    #   # - ENABLE_TCP6=true  # Enable TCP over IPv6
    ports:
      - 8686:8686  # Exposing the Vector API (if needed)
      # - 9598:9598  # Metrics scraping or other purposes
      # - 9000:9000  # Exposing the syslog UDP port on port 9000 
      # - 514:514  # syslog endpoint
    restart: always
    depends_on:
      - victorialogs
    user: root
    networks:
      - adysis-metrics
    # network_mode: host  # Use host network mode directly
    # dns:
    #   - 127.0.0.1  # Docker's internal DNS resolver

  # victoriametrics:
  #   image: victoriametrics/victoria-metrics:v1.112.0
  #   ports:
  #     - '8428:8428'
  #   command:
  #     - -storageDataPath=/vmsingle
  #     - -loggerFormat=json
  #   volumes:
  #     - victoriametrics:/vmsingle

  # Alertmanager for handling alerts
  # alertmanager:
  #   container_name: alertmanager
  #   image: prom/alertmanager:v0.28.1
  #   volumes:
  #     # - .alertmanager.yml:/config/alertmanager.yml
  #     - ./alertmanager.yml:/etc/alertmanager/alertmanager.yml
  #   environment:
  #     - ENABLE_TCP6=true  # Enable TCP over IPv6
  #   # command:
  #     # - ./alertmanager.yml=/alertmanager.yml
  #     # - "--web.listen-address=:9093"  # Optional: bind to specific address or port
  #   ports:
  #     - 9093:9093  # metrics
  #     - 8880:8880  
  #   restart: always
  #   networks:
  #     - adysis-metrics
  #   # network_mode: host  # Use host network mode directly
  #   dns:
  #     - 127.0.0.1  # Docker's internal DNS resolver

volumes:
  # victoria-metrics-data: {}  # Define the volume for Victoria Metrics
  victorialogs-data: {}  # Define the volume for VictoriaLogs
  # victoriametrics: 


networks:
  adysis-metrics:
    name: adysis-metrics
    driver: bridge # Use the external network shared with Victoria Metrics and Perses




